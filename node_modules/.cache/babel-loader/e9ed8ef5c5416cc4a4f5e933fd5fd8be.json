{"ast":null,"code":"'use strict';\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n}; //Constants\n\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDnd = require('react-dnd');\n\nvar _reactDndHtml5Backend = require('react-dnd-html5-backend');\n\nvar _reactDndHtml5Backend2 = _interopRequireDefault(_reactDndHtml5Backend);\n\nvar _noop = require('lodash/noop');\n\nvar _noop2 = _interopRequireDefault(_noop);\n\nvar _uniq = require('lodash/uniq');\n\nvar _uniq2 = _interopRequireDefault(_uniq);\n\nvar _Suggestions = require('./Suggestions');\n\nvar _Suggestions2 = _interopRequireDefault(_Suggestions);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _memoizeOne = require('memoize-one');\n\nvar _memoizeOne2 = _interopRequireDefault(_memoizeOne);\n\nvar _Tag = require('./Tag');\n\nvar _Tag2 = _interopRequireDefault(_Tag);\n\nvar _utils = require('./utils');\n\nvar _constants = require('./constants');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar updateClassNames = (0, _memoizeOne2.default)(function (classNames) {\n  return {\n    classNames: _extends({}, _constants.DEFAULT_CLASSNAMES, classNames)\n  };\n});\n\nvar ReactTags = function (_Component) {\n  _inherits(ReactTags, _Component);\n\n  function ReactTags(props) {\n    _classCallCheck(this, ReactTags);\n\n    var _this = _possibleConstructorReturn(this, (ReactTags.__proto__ || Object.getPrototypeOf(ReactTags)).call(this, props));\n\n    _initialiseProps.call(_this);\n\n    if (!props.inline) {\n      /* eslint-disable no-console */\n      console.warn('[Deprecation] The inline attribute is deprecated and will be removed in v7.x.x, please use inputFieldPosition instead.');\n      /* eslint-enable no-console */\n    }\n\n    var suggestions = props.suggestions,\n        classNames = props.classNames;\n    _this.state = {\n      suggestions: suggestions,\n      query: '',\n      isFocused: false,\n      selectedIndex: -1,\n      selectionMode: false,\n      classNames: _extends({}, _constants.DEFAULT_CLASSNAMES, classNames)\n    }; // TODO : remove classNames from state and change updateClassNames to instance function\n\n    _this.handleFocus = _this.handleFocus.bind(_this);\n    _this.handleBlur = _this.handleBlur.bind(_this);\n    _this.handleKeyDown = _this.handleKeyDown.bind(_this);\n    _this.handleChange = _this.handleChange.bind(_this);\n    _this.moveTag = _this.moveTag.bind(_this);\n    _this.handlePaste = _this.handlePaste.bind(_this);\n    _this.resetAndFocusInput = _this.resetAndFocusInput.bind(_this);\n    _this.handleSuggestionHover = _this.handleSuggestionHover.bind(_this);\n    _this.handleSuggestionClick = _this.handleSuggestionClick.bind(_this);\n    return _this;\n  }\n\n  _createClass(ReactTags, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var _props = this.props,\n          autofocus = _props.autofocus,\n          readOnly = _props.readOnly;\n\n      if (autofocus && !readOnly) {\n        this.resetAndFocusInput();\n      }\n    }\n  }, {\n    key: 'filteredSuggestions',\n    value: function filteredSuggestions(query, suggestions) {\n      var _this2 = this;\n\n      if (this.props.handleFilterSuggestions) {\n        return this.props.handleFilterSuggestions(query, suggestions);\n      }\n\n      var exactSuggestions = suggestions.filter(function (item) {\n        return _this2.getQueryIndex(query, item) === 0;\n      });\n      var partialSuggestions = suggestions.filter(function (item) {\n        return _this2.getQueryIndex(query, item) > 0;\n      });\n      return exactSuggestions.concat(partialSuggestions);\n    }\n  }, {\n    key: 'resetAndFocusInput',\n    value: function resetAndFocusInput() {\n      this.setState({\n        query: ''\n      });\n\n      if (this.textInput) {\n        this.textInput.value = '';\n        this.textInput.focus();\n      }\n    }\n  }, {\n    key: 'handleDelete',\n    value: function handleDelete(i, e) {\n      this.props.handleDelete(i, e);\n\n      if (!this.props.resetInputOnDelete) {\n        this.textInput && this.textInput.focus();\n      } else {\n        this.resetAndFocusInput();\n      }\n\n      e.stopPropagation();\n    }\n  }, {\n    key: 'handleTagClick',\n    value: function handleTagClick(i, e) {\n      if (this.props.handleTagClick) {\n        this.props.handleTagClick(i, e);\n      }\n\n      if (!this.props.resetInputOnDelete) {\n        this.textInput && this.textInput.focus();\n      } else {\n        this.resetAndFocusInput();\n      }\n    }\n  }, {\n    key: 'handleChange',\n    value: function handleChange(e) {\n      if (this.props.handleInputChange) {\n        this.props.handleInputChange(e.target.value);\n      }\n\n      var query = e.target.value.trim();\n      var suggestions = this.filteredSuggestions(query, this.props.suggestions);\n      var selectedIndex = this.state.selectedIndex;\n      this.setState({\n        query: query,\n        suggestions: suggestions,\n        selectedIndex: selectedIndex >= suggestions.length ? suggestions.length - 1 : selectedIndex\n      });\n    }\n  }, {\n    key: 'handleFocus',\n    value: function handleFocus(e) {\n      var value = e.target.value;\n\n      if (this.props.handleInputFocus) {\n        this.props.handleInputFocus(value);\n      }\n\n      this.setState({\n        isFocused: true\n      });\n    }\n  }, {\n    key: 'handleBlur',\n    value: function handleBlur(e) {\n      var value = e.target.value;\n\n      if (this.props.handleInputBlur) {\n        this.props.handleInputBlur(value);\n\n        if (this.textInput) {\n          this.textInput.value = '';\n        }\n      }\n\n      this.setState({\n        isFocused: false\n      });\n    }\n  }, {\n    key: 'handleKeyDown',\n    value: function handleKeyDown(e) {\n      var _state = this.state,\n          query = _state.query,\n          selectedIndex = _state.selectedIndex,\n          suggestions = _state.suggestions,\n          selectionMode = _state.selectionMode; // hide suggestions menu on escape\n\n      if (e.keyCode === _constants.KEYS.ESCAPE) {\n        e.preventDefault();\n        e.stopPropagation();\n        this.setState({\n          selectedIndex: -1,\n          selectionMode: false,\n          suggestions: []\n        });\n      } // When one of the terminating keys is pressed, add current query to the tags.\n      // If no text is typed in so far, ignore the action - so we don't end up with a terminating\n      // character typed in.\n\n\n      if (this.props.delimiters.indexOf(e.keyCode) !== -1 && !e.shiftKey) {\n        if (e.keyCode !== _constants.KEYS.TAB || query !== '') {\n          e.preventDefault();\n        }\n\n        var selectedQuery = selectionMode && selectedIndex !== -1 ? suggestions[selectedIndex] : _defineProperty({\n          id: query\n        }, this.props.labelField, query);\n\n        if (selectedQuery !== '') {\n          this.addTag(selectedQuery);\n        }\n      } // when backspace key is pressed and query is blank, delete tag\n\n\n      if (e.keyCode === _constants.KEYS.BACKSPACE && query === '' && this.props.allowDeleteFromEmptyInput) {\n        this.handleDelete(this.props.tags.length - 1, e);\n      } // up arrow\n\n\n      if (e.keyCode === _constants.KEYS.UP_ARROW) {\n        e.preventDefault();\n        this.setState({\n          selectedIndex: selectedIndex <= 0 ? suggestions.length - 1 : selectedIndex - 1,\n          selectionMode: true\n        });\n      } // down arrow\n\n\n      if (e.keyCode === _constants.KEYS.DOWN_ARROW) {\n        e.preventDefault();\n        this.setState({\n          selectedIndex: suggestions.length === 0 ? -1 : (selectedIndex + 1) % suggestions.length,\n          selectionMode: true\n        });\n      }\n    }\n  }, {\n    key: 'handlePaste',\n    value: function handlePaste(e) {\n      var _this3 = this;\n\n      if (!this.props.allowAdditionFromPaste) {\n        return;\n      }\n\n      e.preventDefault();\n      var clipboardData = e.clipboardData || window.clipboardData;\n      var clipboardText = clipboardData.getData('text');\n      var _props$maxLength = this.props.maxLength,\n          maxLength = _props$maxLength === undefined ? clipboardText.length : _props$maxLength;\n      var maxTextLength = Math.min(maxLength, clipboardText.length);\n      var pastedText = clipboardData.getData('text').substr(0, maxTextLength); // Used to determine how the pasted content is split.\n\n      var delimiterRegExp = (0, _utils.buildRegExpFromDelimiters)(this.props.delimiters);\n      var tags = pastedText.split(delimiterRegExp); // Only add unique tags\n\n      (0, _uniq2.default)(tags).forEach(function (tag) {\n        return _this3.addTag(_defineProperty({\n          id: tag\n        }, _this3.props.labelField, tag));\n      });\n    }\n  }, {\n    key: 'handleSuggestionClick',\n    value: function handleSuggestionClick(i) {\n      this.addTag(this.state.suggestions[i]);\n    }\n  }, {\n    key: 'handleSuggestionHover',\n    value: function handleSuggestionHover(i) {\n      this.setState({\n        selectedIndex: i,\n        selectionMode: true\n      });\n    }\n  }, {\n    key: 'moveTag',\n    value: function moveTag(dragIndex, hoverIndex) {\n      var tags = this.props.tags; // locate tags\n\n      var dragTag = tags[dragIndex]; // call handler with the index of the dragged tag\n      // and the tag that is hovered\n\n      this.props.handleDrag(dragTag, dragIndex, hoverIndex);\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this4 = this;\n\n      var tagItems = this.getTagItems(); // get the suggestions for the given query\n\n      var query = this.state.query.trim(),\n          selectedIndex = this.state.selectedIndex,\n          suggestions = this.state.suggestions;\n      var _props2 = this.props,\n          placeholder = _props2.placeholder,\n          inputName = _props2.name,\n          inputId = _props2.id,\n          maxLength = _props2.maxLength,\n          inline = _props2.inline,\n          inputFieldPosition = _props2.inputFieldPosition;\n      var position = !inline ? _constants.INPUT_FIELD_POSITIONS.BOTTOM : inputFieldPosition;\n      var tagInput = !this.props.readOnly ? _react2.default.createElement('div', {\n        className: this.state.classNames.tagInput\n      }, _react2.default.createElement('input', {\n        ref: function ref(input) {\n          _this4.textInput = input;\n        },\n        className: this.state.classNames.tagInputField,\n        type: 'text',\n        placeholder: placeholder,\n        'aria-label': placeholder,\n        onFocus: this.handleFocus,\n        onBlur: this.handleBlur,\n        onChange: this.handleChange,\n        onKeyDown: this.handleKeyDown,\n        onPaste: this.handlePaste,\n        name: inputName,\n        id: inputId,\n        maxLength: maxLength,\n        value: this.props.inputValue\n      }), _react2.default.createElement(_Suggestions2.default, {\n        query: query,\n        suggestions: suggestions,\n        labelField: this.props.labelField,\n        selectedIndex: selectedIndex,\n        handleClick: this.handleSuggestionClick,\n        handleHover: this.handleSuggestionHover,\n        minQueryLength: this.props.minQueryLength,\n        shouldRenderSuggestions: this.props.shouldRenderSuggestions,\n        isFocused: this.state.isFocused,\n        classNames: this.state.classNames,\n        renderSuggestion: this.props.renderSuggestion\n      })) : null;\n      return _react2.default.createElement('div', {\n        className: (0, _classnames2.default)(this.state.classNames.tags, 'react-tags-wrapper')\n      }, position === _constants.INPUT_FIELD_POSITIONS.TOP && tagInput, _react2.default.createElement('div', {\n        className: this.state.classNames.selected\n      }, tagItems, position === _constants.INPUT_FIELD_POSITIONS.INLINE && tagInput), position === _constants.INPUT_FIELD_POSITIONS.BOTTOM && tagInput);\n    }\n  }], [{\n    key: 'getDerivedStateFromProps',\n    value: function getDerivedStateFromProps(props) {\n      var classNames = props.classNames;\n      return updateClassNames(classNames);\n    }\n  }]);\n\n  return ReactTags;\n}(_react.Component);\n\nReactTags.propTypes = {\n  placeholder: _propTypes2.default.string,\n  labelField: _propTypes2.default.string,\n  suggestions: _propTypes2.default.arrayOf(_propTypes2.default.shape({\n    id: _propTypes2.default.string.isRequired\n  })),\n  delimiters: _propTypes2.default.arrayOf(_propTypes2.default.number),\n  autofocus: _propTypes2.default.bool,\n  inline: _propTypes2.default.bool,\n  // TODO: Remove in v7.x.x\n  inputFieldPosition: _propTypes2.default.oneOf([_constants.INPUT_FIELD_POSITIONS.INLINE, _constants.INPUT_FIELD_POSITIONS.TOP, _constants.INPUT_FIELD_POSITIONS.BOTTOM]),\n  handleDelete: _propTypes2.default.func,\n  handleAddition: _propTypes2.default.func,\n  handleDrag: _propTypes2.default.func,\n  handleFilterSuggestions: _propTypes2.default.func,\n  handleTagClick: _propTypes2.default.func,\n  allowDeleteFromEmptyInput: _propTypes2.default.bool,\n  allowAdditionFromPaste: _propTypes2.default.bool,\n  allowDragDrop: _propTypes2.default.bool,\n  resetInputOnDelete: _propTypes2.default.bool,\n  handleInputChange: _propTypes2.default.func,\n  handleInputFocus: _propTypes2.default.func,\n  handleInputBlur: _propTypes2.default.func,\n  minQueryLength: _propTypes2.default.number,\n  shouldRenderSuggestions: _propTypes2.default.func,\n  removeComponent: _propTypes2.default.func,\n  autocomplete: _propTypes2.default.oneOfType([_propTypes2.default.bool, _propTypes2.default.number]),\n  readOnly: _propTypes2.default.bool,\n  classNames: _propTypes2.default.object,\n  name: _propTypes2.default.string,\n  id: _propTypes2.default.string,\n  maxLength: _propTypes2.default.number,\n  inputValue: _propTypes2.default.string,\n  tags: _propTypes2.default.arrayOf(_propTypes2.default.shape({\n    id: _propTypes2.default.string.isRequired,\n    className: _propTypes2.default.string\n  })),\n  allowUnique: _propTypes2.default.bool,\n  renderSuggestion: _propTypes2.default.func\n};\nReactTags.defaultProps = {\n  placeholder: _constants.DEFAULT_PLACEHOLDER,\n  labelField: _constants.DEFAULT_LABEL_FIELD,\n  suggestions: [],\n  delimiters: [_constants.KEYS.ENTER, _constants.KEYS.TAB],\n  autofocus: true,\n  inline: true,\n  // TODO: Remove in v7.x.x\n  inputFieldPosition: _constants.INPUT_FIELD_POSITIONS.INLINE,\n  handleDelete: _noop2.default,\n  handleAddition: _noop2.default,\n  allowDeleteFromEmptyInput: true,\n  allowAdditionFromPaste: true,\n  resetInputOnDelete: true,\n  autocomplete: false,\n  readOnly: false,\n  allowUnique: true,\n  allowDragDrop: true,\n  tags: []\n};\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this5 = this;\n\n  this.getQueryIndex = function (query, item) {\n    return item[_this5.props.labelField].toLowerCase().indexOf(query.toLowerCase());\n  };\n\n  this.addTag = function (tag) {\n    var _props3 = _this5.props,\n        tags = _props3.tags,\n        labelField = _props3.labelField,\n        allowUnique = _props3.allowUnique;\n\n    if (!tag.id || !tag[labelField]) {\n      return;\n    }\n\n    var existingKeys = tags.map(function (tag) {\n      return tag.id.toLowerCase();\n    }); // Return if tag has been already added\n\n    if (allowUnique && existingKeys.indexOf(tag.id.toLowerCase()) >= 0) {\n      return;\n    }\n\n    if (_this5.props.autocomplete) {\n      var possibleMatches = _this5.filteredSuggestions(tag[labelField], _this5.props.suggestions);\n\n      if (_this5.props.autocomplete === 1 && possibleMatches.length === 1 || _this5.props.autocomplete === true && possibleMatches.length) {\n        tag = possibleMatches[0];\n      }\n    } // call method to add\n\n\n    _this5.props.handleAddition(tag); // reset the state\n\n\n    _this5.setState({\n      query: '',\n      selectionMode: false,\n      selectedIndex: -1\n    });\n\n    _this5.resetAndFocusInput();\n  };\n\n  this.getTagItems = function () {\n    var _props4 = _this5.props,\n        tags = _props4.tags,\n        labelField = _props4.labelField,\n        removeComponent = _props4.removeComponent,\n        readOnly = _props4.readOnly,\n        allowDragDrop = _props4.allowDragDrop;\n    var classNames = _this5.state.classNames;\n    var moveTag = allowDragDrop ? _this5.moveTag : null;\n    return tags.map(function (tag, index) {\n      return _react2.default.createElement(_Tag2.default, {\n        key: tag.id + '-' + index,\n        index: index,\n        tag: tag,\n        labelField: labelField,\n        onDelete: _this5.handleDelete.bind(_this5, index),\n        moveTag: moveTag,\n        removeComponent: removeComponent,\n        onTagClicked: _this5.handleTagClick.bind(_this5, index),\n        readOnly: readOnly,\n        classNames: classNames,\n        allowDragDrop: allowDragDrop\n      });\n    });\n  };\n};\n\nmodule.exports = {\n  WithContext: (0, _reactDnd.DragDropContext)(_reactDndHtml5Backend2.default)(ReactTags),\n  WithOutContext: ReactTags,\n  KEYS: _constants.KEYS\n};","map":null,"metadata":{},"sourceType":"script"}